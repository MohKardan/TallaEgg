# قابلیت کنترل اجباری بودن کد دعوت (Referral Code Control Feature)

## 📋 خلاصه قابلیت

این قابلیت امکان فعال/غیرفعال کردن اجباری بودن کد دعوت برای کاربران جدید را فراهم می‌کند.

## ⚙️ تنظیمات

### فایل پیکربندی: `TelegramBot/TallaEgg.TelegramBot/appsettings.json`

```json
{
  "BotSettings": {
    "RequireReferralCode": true,
    "DefaultReferralCode": "ADMIN2024"
  }
}
```

### پارامترها:
- **`RequireReferralCode`**: `true` = اجباری | `false` = اختیاری
- **`DefaultReferralCode`**: کد پیش‌فرض برای زمانی که اجباری نیست

## 🎛️ دستورات مدیریتی

فقط ادمین‌ها می‌توانند این دستورات را استفاده کنند:

### `/admin_referral_on`
- **عملکرد**: فعال کردن اجباری بودن کد دعوت
- **نتیجه**: کاربران جدید باید کد دعوت داشته باشند

### `/admin_referral_off`
- **عملکرد**: غیرفعال کردن اجباری بودن کد دعوت
- **نتیجه**: کاربران جدید با کد پیش‌فرض ثبت‌نام می‌شوند

### `/admin_referral_status`
- **عملکرد**: نمایش وضعیت فعلی و راهنمای دستورات
- **خروجی**: وضعیت فعال/غیرفعال، کد پیش‌فرض، لیست دستورات

## 🔄 نحوه عملکرد

### حالت اجباری (RequireReferralCode = true):
```
/start کد_دعوت     ✅ ثبت‌نام با کد دعوت
/start             ❌ درخواست کد دعوت
```

### حالت اختیاری (RequireReferralCode = false):
```
/start کد_دعوت     ✅ ثبت‌نام با کد دعوت وارد شده
/start             ✅ ثبت‌نام با کد پیش‌فرض (ADMIN2024)
```

## 🔐 مجوز دسترسی

### تشخیص ادمین بر اساس:
1. **وضعیت کاربر**: حاوی "admin" یا "root"
2. **شناسه تلگرام**: لیست ادمین‌های تعریف شده
3. **قابل تنظیم**: در متد `IsUserAdmin` کلاس `BotHandler`

## 🚀 مزایا

- ✅ **قابلیت تنظیم در زمان اجرا**: بدون نیاز به ری‌استارت ربات
- ✅ **کنترل ادمین محور**: فقط ادمین‌ها قابلیت تغییر دارند
- ✅ **انعطاف‌پذیری**: امکان فعال/غیرفعال کردن بر اساس نیاز
- ✅ **کد پیش‌فرض**: جلوگیری از مشکل در صورت غیرفعال بودن
- ✅ **گزارش‌گیری**: نمایش وضعیت و راهنمای استفاده

## 📁 فایل‌های تغییر یافته

### اصلی:
- `TelegramBot/TallaEgg.TelegramBot/BotHandler.cs`
- `TelegramBot/TallaEgg.TelegramBot/Program.cs`
- `TelegramBot/TallaEgg.TelegramBot/appsettings.json`

### داکیومنت:
- `AGENT.md` (بروزرسانی شده)
